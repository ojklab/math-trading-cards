<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>バトル画面</title>

    <link href="./battle.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container">
      <div class="top-row">
        <div></div>
        <div class="timer">のこり：0:30</div>
      </div>

      <div class="main-area">
        <div class="enemy-area">
          <div class="enemy-card">てき</div>
          <p>HP 30</p>
          <p>+100(スコア)</p>

          <div class="enemy-card-small">
            <div class="level">LEVEL 3</div>
            <div class="img"></div>
            <div class="name">ELEPHANT</div>
            <div class="status">
              <span>HP 10</span>
              <span>POWER 5</span>
            </div>
          </div>

          <p>HP 30 なまえ</p>
          <p>Next ××</p>
        </div>

        <div class="right-area">
          <div class="question-box" id="questionBox">1 + 2 = ?</div>

          <div class="number-pad">
            <div>1</div>
            <div>2</div>
            <div>3</div>
            <div>4</div>
            <div>5</div>
            <div>←</div>
            <div>6</div>
            <div>7</div>
            <div>8</div>
            <div>9</div>
            <div>0</div>
            <div class="confirm-btn">○</div>
          </div>

          <div class="gauge-area">
            <span class="skill-name">必殺技なまえ</span>
            <div class="gauge-wrapper">
              <div class="gauge"></div>
            </div>
            <button class="go-btn">go!</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      //------------------------------------
      // 九九問題ランダム生成
      //------------------------------------
      function makeQuestionTypeA() {
        let a = Math.floor(Math.random() * 9) + 1;
        let b = Math.floor(Math.random() * 9) + 1;
        return { text: `${a} × ${b} ＝ ?`, answer: a * b };
      }

      function makeQuestionTypeB() {
        let a = Math.floor(Math.random() * 9) + 1;
        let b = Math.floor(Math.random() * 9) + 1;
        return { text: `${a} × ? ＝ ${a * b}`, answer: b };
      }

      function getRandomQuestion() {
        return Math.random() < 0.5 ? makeQuestionTypeA() : makeQuestionTypeB();
      }

      //------------------------------------
      // 問題表示
      //------------------------------------
      let currentQuestion;
      let score = 0;

      function showQuestion() {
        currentQuestion = getRandomQuestion();
        document.getElementById('questionBox').textContent = currentQuestion.text;

        // 前の選択をクリア
        selectedAnswer = null;
        numbers.forEach((n) => n.classList.remove('selected'));
      }

      //------------------------------------
      // 数字クリック処理
      //------------------------------------
      let selectedAnswer = null;
      const numbers = document.querySelectorAll('.number-pad div');

      numbers.forEach((num) => {
        num.addEventListener('click', () => {
          // ハイライト消す
          numbers.forEach((n) => n.classList.remove('selected'));
          num.classList.add('selected');

          // 数字以外（← や ○）は無視
          if (!isNaN(num.textContent)) {
            selectedAnswer = Number(num.textContent);
          }
        });
      });

      //------------------------------------
      // ○ボタンで答え確定
      //------------------------------------
      const confirmBtn = document.querySelector('.confirm-btn');

      confirmBtn.addEventListener('click', () => {
        if (selectedAnswer === null) return;

        if (selectedAnswer === currentQuestion.answer) {
          score++;
          showQuestion(); // 次の問題へ
        } else {
          console.log('不正解！');
        }
      });

      //------------------------------------
      // ゲージ
      //------------------------------------
      let gaugeValue = 60;
      const gaugeEl = document.querySelector('.gauge');

      function addGauge() {
        gaugeValue += 20;
        if (gaugeValue > 100) gaugeValue = 100;
        gaugeEl.style.width = gaugeValue + '%';
      }

      document.querySelector('.go-btn').addEventListener('click', addGauge);

      //------------------------------------
      // タイマー
      //------------------------------------
      let timeLeft = 30;
      const timerEl = document.querySelector('.timer');

      const timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `のこり：0:${String(timeLeft).padStart(2, '0')}`;

        if (timeLeft <= 0) {
          clearInterval(timer);
          timerEl.textContent = 'のこり：0:00';

          localStorage.setItem('score', score);
          localStorage.setItem('level', 3);

          window.location.href = 'result.html';
        }
      }, 1000);

      //------------------------------------
      // 最初の問題を出す
      //------------------------------------
      showQuestion();
    </script>
  </body>
</html>
